# **Python高级语法——网络编程——进阶学习笔记**

# 1 HTTP协议

## 1.1 HTTP协议是什么？
- http协议全名叫做：超文本传输协议。
- http协议就是通信的双方（通常指客户端和服务器）进行数据传输的一种约定好的规范！
- 是互联网上最广泛的一种协议。

    例如，我们打开浏览器，输入http://so.com/就可以访问360搜索，这就是通过http协议进行的一次访问。
    其实，说了这么多，可能我们对http的理解，还是很模糊，不着急，我们接着往后看。
    我们举个例子，以前的人们通信的时候通过写信的方式。
    而一般写信是有格式，一般分为称呼、正文、结尾、署名、日期等等，
    写信人通过这种格式写完信寄出去，收信人也通过这种格式进行回信。
    而这种格式就是某种意义上的一种规范协议。当然，很多人会问，
    小酷你骗人，不按照这种方式写信，别人都读不懂了吗！
    当然不是，人是活的，但机器是死的。互相通信的两个机器只能通过某种约定好的协议进行通信，
    只有通过这种约定好的方式通信，通信的双方才能看懂对方发过来的是什么。

- http协议协议规定就体现在:请求报文（浏览器发给服务器）和响应报文（服务器发给浏览器）里面
    - 报文里面有四部分组成：状态行、头部（首部行）、空行、体(正文信息)
    - 头(Head)和正文(Body)以一个空行隔开，参考005_005HTTP请求报文图片
    - 头信息里面看似类似字典的键值，实际是一连串的字符串，以空格和换行隔开
    - 目前使用的协议为HTTP/1.1 HTTP/2.0  
    
- 请求报文
    最主要的头两行分析如下：    
    第一行：
    GET / HTTP/1.1
    GET表示一个读取请求，将从服务器获得网页数据，/表示URL的路径，URL总是以/开头，/就表示首页，
    最后的HTTP/1.1指示采用的HTTP协议版本是1.1。目前HTTP协议的版本就是1.1，
    但是大部分服务器也支持1.0版本，主要区别在于1.1版本允许多个HTTP请求复用一个TCP连接，以加快传输速度。
    
    从第二行开始，每一行都类似于字典格式：  Xxx: abcdefg
    Host: www.sina.com
    表示请求的域名是www.sina.com。如果一台服务器有多个网站，服务器就需要通过Host来区分浏览器请求的是哪个网站。
    参考图片：005_005/006/007
    005_010HTTP请求报文实例
    
- 响应报文
    HTTP响应分为Header(包含状态栏和首部行)和Body两部分（Body是可选项），我们在Network中看到的Header最重要的几行如下：
    HTTP/1.1 200 OK
    200表示一个成功的响应，后面的OK是说明。
    如果返回的不是200，那么往往有其他的功能，例如
    失败的响应有404 Not Found：网页不存在
    500 Internal Server Error：服务器内部出错
    ...等等...

    Content-Type: text/html
    Content-Type指示响应的内容，这里是text/html表示HTML网页。
    请注意，浏览器就是依靠Content-Type来判断响应的内容是网页还是图片，是视频还是音乐。
    浏览器并不靠URL来判断响应的内容，所以，即使URL是http://www.baidu.com/meimei.jpg，它也不一定就是图片。
    HTTP响应的Body就是HTML源码。
    
    请再次注意，Body的数据类型由Content-Type头来确定，
    如果是网页，Body就是文本，如果是图片，Body就是图片的二进制数据。
    当存在Content-Encoding时，Body数据是被压缩的，最常见的压缩方式是gzip，
    所以，看到Content-Encoding: gzip时，需要将Body数据先解压缩，才能得到真正的数据。
    压缩的目的在于减少Body的大小，加快网络传输。
    
    参考图片：005_008/009
    005_011HTTP响应报文实例


- 模拟HTTP请求
    1. 打开网络助手，选择TCP服务器端，打开
    2. 打开浏览器，输入网址：127.0.0.1:8080
    3. 打开网址，网络调试助手中就接收到请求报文了
    
    请求报文：
    GET / HTTP/1.1
    Host: 127.0.0.1:8080
    Connection: keep-alive
    Cache-Control: max-age=0
    Upgrade-Insecure-Requests: 1
    User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.25 Safari/537.36 Core/1.70.3719.400 QQBrowser/10.5.3715.400
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
    Accept-Encoding: gzip, deflate, br
    Accept-Language: zh-CN,zh;q=0.9
    
    4. 网络调试助手,编辑消息发送回去，作为响应报文
    
    响应报文（至少有以下三行信息，状态，空行，正文）：
    HTTP/1.1 200 OK

    <h1>我是响应正文</h1>
    
    参考图片：006_http请求过程模拟结果
   
    
## 1.2 HTTP协议的特点
- http协议的特点总结起来就一下几点：
    1、http协议支持客户端/服务端模式，也是一种请求/响应模式的协议。
    2、无连接
        所谓的无连接就是服务器收到了客户端的请求之后，响应完成并收到客户端的应答之后，即断开连接。
        限制每次的连接只处理一次请求。从而节省传输时间。
    3、无状态
        http协议对事务的处理没有记忆能力。
        也就意味着如果需要前面的信息，只能重传，这无形之中增加数据的传输量。
        这种方式某种方面上讲解放了服务器，但是却不利于客户端与服务器的连接。
        为了弥补这种不足，产生了两项记录http状态的技术，一个叫做Cookie,一个叫做Session。
    4、简单快捷
        所谓的简单快捷是指客户端向服务器请求服务时，一般来说只需要传输请求方法和路径，就能进行访问。
    5、灵活
        这里主要指的是客户端可以通过http协议传输任意类型的数据。
        比如传输.jpg文件、.ppt文件等等，只需要设定content-type就可以进行传输。
 
        
## 1.3 http请求/响应的步骤是什么？
- 具体步骤：
    1、客户端连接到web服务器：客户端，我们通常指的是浏览器，与web服务器的http端口（默认情况下80）建立一个TCP套接字的连接。
    2、发送HTTP请求：通过TCP套接字，浏览器向web服务器发送一个请求报文，一个请求报文包括请求行、请求头、空行、请求体四部分。
    3、服务器端解析请求并返回http响应：web服务器解析请求，定位资源，返回响应报文。
    4、释放TCP连接：web浏览器主动关闭TCP套接字，关闭TCP连接。而客户端则需要被动的关闭TCP套接字，释放TCP连接。
    5、客户端浏览器解析响应报文，解析成HTML内容，经过浏览器的渲染之后就能展示给人们了。



    


